{"version":3,"file":"formulacreator.min.js","sources":["../src/formulacreator.js"],"sourcesContent":["/// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle. If not, see &lt;http://www.gnu.org/licenses/&gt;.\n// Project implemented by the &quot;Recovery, Transformation and Resilience Plan.\n// Funded by the European Union - Next GenerationEU&quot;.\n//\n// Produced by the UNIMOODLE University Group: Universities of\n// Valladolid, Complutense de Madrid, UPV/EHU, León, Salamanca,\n// Illes Balears, Valencia, Rey Juan Carlos, La Laguna, Zaragoza, Málaga,\n// Córdoba, Extremadura, Vigo, Las Palmas de Gran Canaria y Burgos.\n/*\n * Display information about all the gradereport_gradeconfigwizard modules in the requested course. *\n * @package gradereport_gradeconfigwizard\n * @copyright 2023 Proyecto UNIMOODLE\n * @author UNIMOODLE Group (Coordinator) &lt;direccion.area.estrategia.digital@uva.es&gt;\n * @author Joan Carbassa (IThinkUPC) &lt;joan.carbassa@ithinkupc.com&gt;\n * @author Yerai Rodríguez (IThinkUPC) &lt;yerai.rodriguez@ithinkupc.com&gt;\n * @author Marc Geremias (IThinkUPC) &lt;marc.geremias@ithinkupc.com&gt;\n * @author Miguel Gutiérrez (UPCnet) &lt;miguel.gutierrez.jariod@upcnet.es&gt;\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n*/\n\n/* START: VARIABLES */\n\nlet selecteditemscheckboxes = document.querySelectorAll('.formulacreator-select-items input[type=checkbox]');\n\nlet aggregationmethoddiv = document.querySelector('.formulacreator-aggregation-method');\nlet weightsdefinitiondiv = document.querySelector('.formulacreator-weights-definition');\nlet weightsdefinitiontable = document.querySelector('.formulacreator-weights-definition table tbody');\nlet aggregationmethodselect = document.querySelector('.formulacreator-aggregation-method select');\n\n\nlet formulapreviewbox = document.querySelector('.formulacreator-formula');\nlet formulapreviewtextarea = document.querySelector('.formulacreator-formula textarea');\nlet previewformulabutton = document.getElementById('formulacreator-preview-formula');\n\n/* END: VARIABLES */\n\n/* START: FUNCTIONS */\n\nconst addEventToCheckbox = () => {\n    // Enable event change to each checkbox of select-items\n    for (let i = 0; i < selecteditemscheckboxes.length; i++) {\n        selecteditemscheckboxes[i].addEventListener('change', function() {\n\n            // START: Enable aggregation methods\n\n            // Check if at least 1 checkbox is checked\n            let alMenosUnoMarcado = false;\n            for (let j = 0; j < selecteditemscheckboxes.length; j++) {\n                if (selecteditemscheckboxes[j].checked) {\n                    alMenosUnoMarcado = true;\n                    break;\n                }\n            }\n            // Habilitar o deshabilitar aggregation method selector según corresponda\n            if (alMenosUnoMarcado) {\n                aggregationmethoddiv.classList.remove(\"disabled-box\");\n                if (aggregationmethodselect.value !== \"0\") {\n                    weightsdefinitiondiv.classList.remove(\"disabled-box\");\n                }\n            } else {\n                aggregationmethoddiv.classList.add(\"disabled-box\");\n                weightsdefinitiondiv.classList.add(\"disabled-box\");\n            }\n\n            // END: Enable aggregation methods\n\n            // START: Add elements a weights definition\n            let weightenabled = '';\n            if (this.checked) {\n                if (aggregationmethodselect.value === 'weightedmeangrades') {\n                    weightenabled = '1';\n                } else {\n                    weightenabled = '0';\n                }\n\n                let newrow = weightsdefinitiontable.insertRow(-1);\n                newrow.innerHTML = '<th scope=\"row\">' +\n                    this.dataset.displayname +\n                    '</th>' +\n                    '<td>' +\n                    '<input type=\"number\"' +\n                    ' min=\"0\"' +\n                    ' step=\"1\"' +\n                    ' data-enabled=\"' + weightenabled + '\"' +\n                    ' data-itemdisplayname=\"' + this.dataset.displayname + '\"' +\n                    ' data-itemidnumber=\"' + this.dataset.idnumber + '\"' +\n                    ' data-itemid=\"' + this.dataset.id + '\"' +\n                    ' data-paramtype=\"weight\"' +\n                    ' class=\"form-control\" placeholder=\"\"' +\n                    ' value=\"1\">' +\n                    '</td>';\n\n                newrow.dataset.id = this.dataset.id;\n            } else {\n                let weightsdefinitionmatchingrow = weightsdefinitiontable.querySelector('[data-id=\"' + this.dataset.id + '\"]');\n                if (weightsdefinitionmatchingrow) {\n                    weightsdefinitionmatchingrow.remove();\n                }\n            }\n\n            // END: Add elements a weights definition\n        });\n    }\n};\n\nconst aggregationSelection = () => {\n    aggregationmethodselect.addEventListener('change', function() {\n        if (this.value === \"0\") {\n            weightsdefinitiondiv.classList.add(\"disabled-box\");\n        } else {\n            weightsdefinitiondiv.classList.remove(\"disabled-box\");\n        }\n        let weightitems = weightsdefinitiondiv.querySelectorAll('[data-paramtype=\"weight\"]');\n\n        switch (this.value) {\n            case 'weightedmeangrades':\n                weightitems.forEach(function(weightitem) {\n                    weightitem.dataset.enabled = 1;\n                    weightitem.classList.remove(\"disabled-box\");\n                });\n                break;\n            case 'meangrades':\n            case 'sum':\n            case 'highest':\n            case 'lowest':\n                weightitems.forEach(function(weightitem) {\n                    weightitem.dataset.enabled = 0;\n                    weightitem.classList.add(\"disabled-box\");\n                });\n                break;\n        }\n\n    });\n};\n\nconst previewFormula = () => {\n\n    previewformulabutton.addEventListener('click', function() {\n\n        formulapreviewbox.classList.remove(\"disabled-box\");\n\n        let selectedformulaitems = weightsdefinitiontable.querySelectorAll('[data-paramtype=\"weight\"]');\n        let itemsformula = '';\n\n        selectedformulaitems.forEach(function (selectedformulaitem) {\n            let itemformula = \"\";\n            itemformula = \"  <ITEM>\";\n\n            itemformula += \"<DISPLAYNAME>\" + selectedformulaitem.dataset.itemdisplayname + \"</DISPLAYNAME>\";\n            itemformula += \"<IDNUMBER>\" + selectedformulaitem.dataset.itemidnumber + \"</IDNUMBER>\";\n            itemformula += \"<GRADEITEMID>\" + selectedformulaitem.dataset.itemid + \"</GRADEITEMID>\";\n\n            //let weightvalue = '';\n            if (selectedformulaitem.dataset.enabled === '1') {\n                itemformula += \"<WEIGHT>\" + selectedformulaitem.value + \"</WEIGHT>\";\n            }\n\n            itemformula += \"</ITEM>\\n\";\n\n            itemsformula += itemformula;\n        });\n\n        let exampleformulas = {\n            \"meangrades\": \"<MEANGRADES>\\n  \" + itemsformula.trim() + \"\\n</MEANGRADES>\",\n            \"weightedmeangrades\": \"<WEIGHTEDMEANGRADES>\\n\" + itemsformula.trim() + \"\\n</WEIGHTEDMEANGRADES>\",\n            \"sum\": \"<SUM>\\n\" + itemsformula.trim() + \"\\n</SUM>\",\n            \"highest\": \"<HIGHEST>\\n\" + itemsformula.trim() + \"\\n</HIGHEST>\",\n            \"lowest\": \"<LOWEST>\\n\" + itemsformula.trim() + \"\\n</LOWEST>\",\n        };\n\n        formulapreviewtextarea.value = exampleformulas[aggregationmethodselect.value];\n    });\n};\n/* END: FUNCTIONS */\n\n\n/* START: EVENT LISTENERS DECLARATION */\n\nexport const init = () => {\n    addEventToCheckbox();\n    aggregationSelection();\n    previewFormula();\n};\n\n/* END: EVENT LISTENERS DECLARATION */\n"],"names":["selecteditemscheckboxes","document","querySelectorAll","aggregationmethoddiv","querySelector","weightsdefinitiondiv","weightsdefinitiontable","aggregationmethodselect","formulapreviewbox","formulapreviewtextarea","previewformulabutton","getElementById","addEventToCheckbox","i","length","addEventListener","alMenosUnoMarcado","j","checked","classList","remove","value","add","weightenabled","this","newrow","insertRow","innerHTML","dataset","displayname","idnumber","id","weightsdefinitionmatchingrow","aggregationSelection","weightitems","forEach","weightitem","enabled","selectedformulaitems","itemsformula","selectedformulaitem","itemformula","itemdisplayname","itemidnumber","itemid","exampleformulas","trim"],"mappings":";;;;;;;;;;;;IAmCIA,wBAA0BC,SAASC,iBAAiB,qDAEpDC,qBAAuBF,SAASG,cAAc,sCAC9CC,qBAAuBJ,SAASG,cAAc,sCAC9CE,uBAAyBL,SAASG,cAAc,kDAChDG,wBAA0BN,SAASG,cAAc,6CAGjDI,kBAAoBP,SAASG,cAAc,2BAC3CK,uBAAyBR,SAASG,cAAc,oCAChDM,qBAAuBT,SAASU,eAAe,wCAM7CC,mBAAqB,SAElB,IAAIC,EAAI,EAAGA,EAAIb,wBAAwBc,OAAQD,IAChDb,wBAAwBa,GAAGE,iBAAiB,UAAU,eAK9CC,mBAAoB,MACnB,IAAIC,EAAI,EAAGA,EAAIjB,wBAAwBc,OAAQG,OAC5CjB,wBAAwBiB,GAAGC,QAAS,CACpCF,mBAAoB,QAKxBA,mBACAb,qBAAqBgB,UAAUC,OAAO,gBACA,MAAlCb,wBAAwBc,OACxBhB,qBAAqBc,UAAUC,OAAO,kBAG1CjB,qBAAqBgB,UAAUG,IAAI,gBACnCjB,qBAAqBc,UAAUG,IAAI,qBAMnCC,cAAgB,MAChBC,KAAKN,QAAS,CAEVK,cADkC,uBAAlChB,wBAAwBc,MACR,IAEA,QAGhBI,OAASnB,uBAAuBoB,WAAW,GAC/CD,OAAOE,UAAY,mBACfH,KAAKI,QAAQC,YADE,gEAOKN,cAPL,2BAQaC,KAAKI,QAAQC,YAR1B,wBASUL,KAAKI,QAAQE,SATvB,kBAUIN,KAAKI,QAAQG,GAVjB,gFAgBnBN,OAAOG,QAAQG,GAAKP,KAAKI,QAAQG,OAC9B,KACCC,6BAA+B1B,uBAAuBF,cAAc,aAAeoB,KAAKI,QAAQG,GAAK,MACrGC,8BACAA,6BAA6BZ,cAS3Ca,qBAAuB,KACzB1B,wBAAwBQ,iBAAiB,UAAU,WAC5B,MAAfS,KAAKH,MACLhB,qBAAqBc,UAAUG,IAAI,gBAEnCjB,qBAAqBc,UAAUC,OAAO,oBAEtCc,YAAc7B,qBAAqBH,iBAAiB,oCAEhDsB,KAAKH,WACJ,qBACDa,YAAYC,SAAQ,SAASC,YACzBA,WAAWR,QAAQS,QAAU,EAC7BD,WAAWjB,UAAUC,OAAO,6BAG/B,iBACA,UACA,cACA,SACDc,YAAYC,SAAQ,SAASC,YACzBA,WAAWR,QAAQS,QAAU,EAC7BD,WAAWjB,UAAUG,IAAI,sCAmDzB,KAChBV,qBACAqB,uBA3CAvB,qBAAqBK,iBAAiB,SAAS,WAE3CP,kBAAkBW,UAAUC,OAAO,oBAE/BkB,qBAAuBhC,uBAAuBJ,iBAAiB,6BAC/DqC,aAAe,GAEnBD,qBAAqBH,SAAQ,SAAUK,yBAC/BC,YAAc,GAClBA,YAAc,WAEdA,aAAe,gBAAkBD,oBAAoBZ,QAAQc,gBAAkB,iBAC/ED,aAAe,aAAeD,oBAAoBZ,QAAQe,aAAe,cACzEF,aAAe,gBAAkBD,oBAAoBZ,QAAQgB,OAAS,iBAG1B,MAAxCJ,oBAAoBZ,QAAQS,UAC5BI,aAAe,WAAaD,oBAAoBnB,MAAQ,aAG5DoB,aAAe,YAEfF,cAAgBE,mBAGhBI,gBAAkB,YACJ,mBAAqBN,aAAaO,OAAS,qCACnC,yBAA2BP,aAAaO,OAAS,8BAChE,UAAYP,aAAaO,OAAS,mBAC9B,cAAgBP,aAAaO,OAAS,sBACvC,aAAeP,aAAaO,OAAS,eAGnDrC,uBAAuBY,MAAQwB,gBAAgBtC,wBAAwBc"}
