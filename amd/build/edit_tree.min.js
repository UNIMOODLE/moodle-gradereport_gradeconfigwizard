define("gradereport_gradeconfigwizard/edit_tree",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;
/*
   * Display information about all the gradereport_gradeconfigwizard modules in the requested course. *
   * @package gradeconfigwizard
   * @copyright 2023 Proyecto UNIMOODLE
   * @author UNIMOODLE Group (Coordinator) &lt;direccion.area.estrategia.digital@uva.es&gt;
   * @author Joan Carbassa (IThinkUPC) &lt;joan.carbassa@ithinkupc.com&gt;
   * @author Yerai Rodríguez (IThinkUPC) &lt;yerai.rodriguez@ithinkupc.com&gt;
   * @author Marc Geremias (IThinkUPC) &lt;marc.geremias@ithinkupc.com&gt;
   * @author Miguel Gutiérrez (UPCnet) &lt;miguel.gutierrez.jariod@upcnet.es&gt;
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
  */
let courseidglobal,actionurlglobal,urlformulacreatorglobal,gradeitemidglobal,wwwrootglobal,gradeconfigwizarddashboardtablebody=document.getElementById("gradeconfigwizard-dashboard-table").querySelector("tbody");const removeitemiconhtml=randomid=>'<i class="fa fa-fw fa-trash-o icon remove-item-icon" \ndata-randomid="'.concat(randomid,'" title="Remove element" role="img" aria-label="Remove element"></i>'),newgradeitemeditactionaddgradeitemcategoryhtml='\n    <a class="add-gradeitemcategory-btn dropdown-item" href="#">\n        <i class="fa fa-plus fa-fw icon itemicon" title="Add category" role="img" aria-label="Add category"></i>\n        Add category\n    </a>\n    ',newgradeitemeditactionaddgradeitemhtml='\n    <a class="add-gradeitem-btn dropdown-item" href="#">\n        <i class="fa fa-plus fa-fw icon itemicon" title="Add gradeitem" role="img" aria-label="Add gradeitem"></i>\n        Add grade item\n    </a>\n    ',newgradeitemeditactioneditcalculationhtml='\n    <a class="dropdown-item" href="'.concat(urlformulacreatorglobal,"id=").concat(courseidglobal,"&gradeitemid=").concat(gradeitemidglobal,'">\n    <i class="fa fa-calculator fa-fw icon itemicon" title="" role="img" aria-label=""></i>\n    Edit calculation\n    </a>\n    '),newgradeitemeditactiondisablehtml='\n    <a class="gradeitem-disable-btn dropdown-item disabled" href="#">\n        <i class="fa fa-minus fa-fw icon itemicon" title="" role="img" aria-label=""></i>\n        Disable\n    </a>\n    ';const generateUniqueId=()=>{let randomid=null;for(;null===randomid||null!==document.getElementById(randomid);)randomid=Math.random().toString(36).substring(2,10);return randomid},getDepthPadding=depth=>{depth=parseInt(depth);let response="";for(let i=0;i<depth;i++)response+='<span class="p-2"></span>';return response},addGradeitemAfterRow=row=>{disableDragging();let alreadycreatedcategory,gradecategoryid=row.dataset.gradecategoryid,gradeitemid=row.dataset.gradeitemid,depth=row.dataset.categorydepth,parentrandomid=row.dataset.randomid,newrandomid=generateUniqueId(),newdepth=parseInt(depth)+1;alreadycreatedcategory=""==parentrandomid?'<input type="hidden" name="gradeitemparent['.concat(newrandomid,']" value="/').concat(gradecategoryid,'">'):'<input type="hidden" name="gradeitemparent['.concat(newrandomid,']" value="').concat(parentrandomid,'">');let newgradeitemrowhtml=((randomid,gradecategoryid,gradeitemid,depth,parentrandomid,alreadycreatedcategory)=>'\n    <tr data-gradecategoryid="'.concat(gradecategoryid,'" data-gradeitemid="').concat(gradeitemid,'"\n     data-itemtype="manual" data-randomid="').concat(randomid,'" id="').concat(randomid,'" data-categorydepth="').concat(depth,'">\n        <td data-id="').concat(gradeitemid,'" data-displayname="">\n            ').concat(getDepthPadding(depth),'\n            <i class="fa fa-square-o fa-fw icon itemicon" title="Category"\n             role="img" aria-label="Category"></i>\n            <input class="subcategoryname" name="subcategoryname[').concat(randomid,']" \n            placeholder="Grade item name" value="" required>').concat(removeitemiconhtml(randomid),"\n            ").concat(alreadycreatedcategory,' \n        </td>\n        <td>\n            <span class="p-2"></span>\n            <input type="text" name="weight" id="" value="1" size="4" disabled=""\n             class="gradeitem-weight form-control d-inline-block">\n        </td>\n        <td>\n            <div class="dropdown">\n                <button class="btn btn-secondary dropdown-toggle disabled" \n                type="button" id="dropdownMenuButton-').concat(gradecategoryid,"-").concat(gradeitemid,'" data-toggle="dropdown" \n                aria-haspopup="true" aria-expanded="false" >\n                    Edit\n                </button>\n                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton-').concat(gradecategoryid,"-").concat(gradeitemid,'">\n                    ').concat(newgradeitemeditactioneditcalculationhtml,"\n                    ").concat(newgradeitemeditactiondisablehtml,"\n                </div>\n            </div>\n        </td>\n    </tr>\n    "))(newrandomid,gradecategoryid,gradeitemid,newdepth,0,alreadycreatedcategory);row.insertAdjacentHTML("afterend",newgradeitemrowhtml);let newgradeitemrow=document.getElementById(newrandomid);return newgradeitemrow.querySelector(".remove-item-icon").addEventListener("click",removeGradeitemButtonClickCallback),newgradeitemrow.querySelector(".gradeitem-disable-btn").addEventListener("click",disableGradeitemButtonClickCallback),newgradeitemrow},removeGradeitemRow=gradeitemrow=>{gradeitemrow.remove(),enableDragging()},disableDragging=()=>{let table=document.getElementById("gradeconfigwizard-dashboard-table");for(let element of table.querySelectorAll("tr"))if("true"==element.dataset.todragg){element.draggable=!1,element.querySelector("#move-icon-display").classList.add("gradeconfigwizard-draggingcontent-color")}},enableDragging=()=>{let table=document.getElementById("gradeconfigwizard-dashboard-table"),abletodragg=!0;for(let element of table.querySelectorAll("tr"))if(null!=element.dataset.randomid&&""!=element.dataset.randomid){abletodragg=!1;break}if(abletodragg)for(let element of table.querySelectorAll("tr"))if("true"==element.dataset.todragg){element.draggable=!0,element.querySelector("#move-icon-display").classList.remove("gradeconfigwizard-draggingcontent-color")}},addGradeitemCategoryAfterRow=row=>{disableDragging();let gradecategoryid=row.dataset.gradecategoryid,gradeitemid=row.dataset.gradeitemid,depth=row.dataset.categorydepth,newrandomid=generateUniqueId(),newdepth=parseInt(depth)+1,parentrelativepath=row.dataset.parentrelativepath;null==parentrelativepath&&(parentrelativepath=gradecategoryid),""==gradecategoryid&&"0"==depth&&(parentrelativepath=courseidglobal),parentrelativepath=parentrelativepath+"/"+newrandomid;let newgradeitemcategoryrowhtml=((randomid,gradecategoryid,gradeitemid,depth,parentrelativepath)=>'\n    <tr data-gradecategoryid="'.concat(gradecategoryid,'" data-gradeitemid="').concat(gradeitemid,'" \n    data-itemtype="category" data-randomid="').concat(randomid,'" id="').concat(randomid,'" \n    data-categorydepth="').concat(depth,'" data-parentrelativepath="').concat(parentrelativepath,'">\n        <td data-id="').concat(gradeitemid,'" data-displayname="">\n            ').concat(getDepthPadding(depth),'\n            <i class="fa fa-folder fa-fw icon itemicon" title="Category" role="img" aria-label="Category"></i>\n            <input class="subcategoryname" name="randomnames_dictionary[').concat(randomid,']"\n             placeholder="Category name" value="" required>').concat(removeitemiconhtml(randomid),'\n            <input type="hidden" name="relativepaths[').concat(randomid,']" value="').concat(parentrelativepath,'">\n        </td>\n        <td>\n            <span class="p-2"></span>\n            <input type="text" name="weight" id="" value="1" \n            size="4" disabled="" class="gradeitem-weight form-control d-inline-block">\n        </td>\n        <td>\n            <div class="dropdown">\n                <button class="btn btn-secondary dropdown-toggle" \n                type="button" id="dropdownMenuButton-').concat(gradecategoryid,"-").concat(gradeitemid,'" \n                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                    Edit\n                </button>\n                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton-').concat(gradecategoryid,"-").concat(gradeitemid,'">\n                    ').concat(newgradeitemeditactionaddgradeitemcategoryhtml,"\n                    ").concat(newgradeitemeditactionaddgradeitemhtml,"\n                    ").concat(newgradeitemeditactiondisablehtml,"\n                </div>\n            </div>\n        </td>\n    </tr>\n    "))(newrandomid,gradecategoryid,gradeitemid,newdepth,parentrelativepath);row.insertAdjacentHTML("afterend",newgradeitemcategoryrowhtml);let newgradeitemcategoryrow=document.getElementById(newrandomid);newgradeitemcategoryrow.querySelector(".remove-item-icon").addEventListener("click",removeGradeitemCategoryButtonClickCallback),newgradeitemcategoryrow.querySelector(".add-gradeitemcategory-btn").addEventListener("click",addGradeitemCategoryButtonClickCallback),newgradeitemcategoryrow.querySelector(".add-gradeitem-btn").addEventListener("click",addGradeitemButtonClickCallback),newgradeitemcategoryrow.querySelector(".gradeitem-disable-btn").addEventListener("click",disableGradeitemButtonClickCallback);let newgradeitemcategorytotalrowhtml=((randomid,gradecategoryid,gradeitemid,depth)=>'\n    <tr data-gradecategoryid="'.concat(gradecategoryid,'" data-gradeitemid="').concat(gradeitemid,'" data-itemtype="category" \n    data-randomid="').concat(randomid,'" data-istotal="1" id="').concat(randomid,'" data-categorydepth="').concat(depth,'">\n        <td data-id="').concat(gradeitemid,'" data-displayname="">\n            ').concat(getDepthPadding(depth),'\n            <i class="fa fa-list fa-fw icon itemicon" title="Category total" role="img" aria-label="Category total"></i>\n            <input class="subcategoryname" name="subcategoryname" value="" disabled="true">\n        </td>\n        <td>\n        </td>\n        <td>\n            <div class="dropdown">\n                <button class="btn btn-secondary dropdown-toggle disabled" type="button" \n                id="dropdownMenuButton-').concat(gradecategoryid,"-").concat(gradeitemid,'" data-toggle="dropdown" \n                aria-haspopup="true" aria-expanded="false">\n                    Edit\n                </button>\n                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton-').concat(gradecategoryid,"-").concat(gradeitemid,'">\n                    ').concat(newgradeitemeditactioneditcalculationhtml,"\n                </div>\n            </div>\n        </td>\n    </tr>\n    "))(newrandomid,gradecategoryid,gradeitemid,parseInt(newdepth)+1);newgradeitemcategoryrow.insertAdjacentHTML("afterend",newgradeitemcategorytotalrowhtml);var newgradeitemcategorytotalrow=gradeconfigwizarddashboardtablebody.querySelector('[data-randomid="'+newrandomid+'"][data-istotal="1"]');return newgradeitemcategoryrow.querySelector(".subcategoryname").addEventListener("input",(function(){newgradeitemcategorytotalrow.querySelector("input.subcategoryname").value="Total "+this.value})),newgradeitemcategoryrow},enableModal=()=>{(()=>{let editcontent=document.getElementById("gradeconfigwizard-modal");editcontent.classList.add("modal"),editcontent.classList.add("modal-content")})(),(()=>{if(null===document.getElementById("background-gradeconfigwizardmodal")){let backgroundmodal=document.createElement("div");backgroundmodal.setAttribute("id","background-gradeconfigwizardmodal"),backgroundmodal.classList.add("modal-backdrop"),backgroundmodal.classList.add("show"),document.getElementById("page-footer").appendChild(backgroundmodal)}})(),document.getElementById("buttons-top").classList.remove("hidden"),document.getElementById("buttons-bottom").classList.remove("hidden")},disableModal=()=>{(()=>{let editcontent=document.getElementById("gradeconfigwizard-modal");editcontent.classList.remove("modal"),editcontent.classList.remove("modal-content")})(),(()=>{let backgroundmodal=document.getElementById("background-gradeconfigwizardmodal"),footer=document.getElementById("page-footer");backgroundmodal&&footer.removeChild(backgroundmodal)})(),document.getElementById("buttons-top").classList.add("hidden"),document.getElementById("buttons-bottom").classList.add("hidden")};let dragged=null,target=null,draggingchilds=[],dropactionredirectinprogress=!1;const dragstart=event=>{setTimeout((()=>{event.target.className="invisible"}),0),dragged=event.target;let under=!1;if("manual"==dragged.dataset.itemtype||"mod"==dragged.dataset.itemtype)return;let element,array=Array.from(gradeconfigwizarddashboardtablebody.querySelectorAll("tr"));for(element of array)if(element.dataset.gradeitemid==dragged.dataset.gradeitemid&&(under=!0),under&&element.dataset.categorydepth>dragged.dataset.categorydepth&&(element.classList.add("gradeconfigwizard-draggingcontent"),draggingchilds.push(element),element.dataset.gradeitemid==dragged.dataset.gradeitemid))break},dragend=event=>{if(!1===dropactionredirectinprogress){for(let element of draggingchilds)element.classList.remove("gradeconfigwizard-draggingcontent");event.target.className=""}},dragover=event=>{event.preventDefault(),target=event.target.closest("tr"),target.className="big-separator"},dragleave=event=>{target=event.target.closest("tr"),target.className="small-separator"},drop=()=>{let move="after";("0"==target.dataset.istotal&&"category"==target.dataset.itemtype||"course"==target.dataset.itemtype)&&(move="inside"),dropactionredirectinprogress=!0,window.location.href=wwwrootglobal+"/grade/report/gradeconfigwizard/index.php?id="+courseidglobal+"&draggedid="+dragged.dataset.gradeitemid+"&targetid="+target.dataset.gradeitemid+"&move="+move},removeGradeitemCategory=gradeitemcategoryrow=>{let parentgradecategorydepth=gradeitemcategoryrow.dataset.categorydepth,currentrow=gradeitemcategoryrow.nextElementSibling;for(;currentrow;){if(parentgradecategorydepth>=currentrow.dataset.categorydepth)break;"category"===currentrow.dataset.itemtype&&"1"!==currentrow.dataset.istotal?removeGradeitemCategory(currentrow):removeGradeitemRow(currentrow),currentrow=gradeitemcategoryrow.nextElementSibling}gradeitemcategoryrow.remove(),enableDragging()},gradeDashboardOnChangeCallback=()=>{document.querySelectorAll("#gradeconfigwizard-dashboard-table input.subcategoryname").length>0?enableModal():disableModal()},targetNode=document.getElementById("gradeconfigwizard-dashboard-table");new MutationObserver((mutationList=>{for(const mutation of mutationList)"attributes"===mutation.type&&gradeDashboardOnChangeCallback()})).observe(targetNode,{attributes:!0,childList:!0,subtree:!0});const addGradeitemButtonClickCallback=e=>{let targetrow=e.target.closest("tr");addGradeitemAfterRow(targetrow).querySelector("input.subcategoryname").focus()},removeGradeitemButtonClickCallback=e=>{let targetrow=e.target.closest("tr");removeGradeitemRow(targetrow)},disableGradeitemButtonClickCallback=e=>{let targetrow=e.target.closest("tr");"mod"===targetrow.dataset.itemtype||"manual"===targetrow.dataset.itemtype?(gradeitemrow=>{let actiongradeitemid=gradeitemrow.dataset.gradeitemid;window.location.href=actionurlglobal+"&action=disablegradeitem&actiongradeitemid="+actiongradeitemid})(targetrow):"category"===targetrow.dataset.itemtype&&(gradeitemrow=>{let actiongradeitemid=gradeitemrow.dataset.gradeitemid;gradeitemrow.textContent.includes("[[DISABLED]]")||(window.location.href=actionurlglobal+"&action=disablegradeitemcategory&actiongradeitemid="+actiongradeitemid)})(targetrow)},addGradeitemCategoryButtonClickCallback=e=>{let targetrow=e.target.closest("tr");addGradeitemCategoryAfterRow(targetrow).querySelector("input.subcategoryname").focus()},removeGradeitemCategoryButtonClickCallback=e=>{let targetrow=e.target.closest("tr");removeGradeitemCategory(targetrow)};_exports.init=(courseid,urlformulacreator,gradeitemid,wwwroot,actionurl)=>{courseidglobal=courseid,urlformulacreatorglobal=urlformulacreator,gradeitemidglobal=gradeitemid,wwwrootglobal=wwwroot,actionurlglobal=actionurl,gradeconfigwizarddashboardtablebody.querySelectorAll(".add-gradeitemcategory-btn").forEach((function(row){row.addEventListener("click",addGradeitemCategoryButtonClickCallback)})),gradeconfigwizarddashboardtablebody.querySelectorAll(".add-gradeitem-btn").forEach((function(row){row.addEventListener("click",addGradeitemButtonClickCallback)})),gradeconfigwizarddashboardtablebody.querySelectorAll(".gradeitem-disable-btn").forEach((function(row){row.addEventListener("click",disableGradeitemButtonClickCallback)})),gradeconfigwizarddashboardtablebody.querySelectorAll("tr").forEach((function(row){row.addEventListener("dragstart",dragstart),row.addEventListener("dragend",dragend),row.addEventListener("dragover",dragover),row.addEventListener("dragleave",dragleave),row.addEventListener("drop",drop)}))}}));

//# sourceMappingURL=edit_tree.min.js.map
