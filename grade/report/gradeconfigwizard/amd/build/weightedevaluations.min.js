define("gradereport_gradeconfigwizard/weightedevaluations",["exports","jquery","core/str"],(function(_exports,_jquery,_str){var obj;
/*
   * Display information about all the gradereport_gradeconfigwizard modules in the requested course. *
   * @package gradeconfigwizard
   * @copyright 2023 Proyecto UNIMOODLE
   * @author UNIMOODLE Group (Coordinator) &lt;direccion.area.estrategia.digital@uva.es&gt;
   * @author Joan Carbassa (IThinkUPC) &lt;joan.carbassa@ithinkupc.com&gt;
   * @author Yerai Rodríguez (IThinkUPC) &lt;yerai.rodriguez@ithinkupc.com&gt;
   * @author Marc Geremias (IThinkUPC) &lt;marc.geremias@ithinkupc.com&gt;
   * @author Miguel Gutiérrez (UPCnet) &lt;miguel.gutierrez.jariod@upcnet.es&gt;
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
  */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};let weightedevaluationtablebody=document.getElementById("weightedevaluations-table").getElementsByTagName("tbody")[0],addcategorybtn=document.getElementById("weightedevaluations-category-create-btn"),gradeitemsmodal=document.querySelector("#available-gradeitems-modal-id"),gradeitemsmodalacceptbutton=gradeitemsmodal.querySelector(".confirm"),saveandexitbutton=document.getElementsByClassName("saveandexit")[0];const removeitemiconhtml=randomid=>'\n<i class="fa fa-fw fa-trash-o icon remove-item-icon" data-randomid="'.concat(randomid,'"\ntitle="Remove element" role="img" aria-label="Remove element"></i>\n'),generateUniqueId=()=>{let randomid=null;for(;null===randomid||null!==document.getElementById(randomid);)randomid=Math.random().toString(36).substring(2,10);return randomid},recalculateRowspans=randomid=>{var categorytotalItemCount=weightedevaluationtablebody.querySelectorAll('tr[data-randomid="'+randomid+'"]').length;weightedevaluationtablebody.querySelectorAll('tr[data-randomid="'+randomid+'"][data-rowtype="category"] td').forEach((datacell=>{datacell.rowSpan=categorytotalItemCount})),weightedevaluationtablebody.querySelectorAll('tr[data-randomid="'+randomid+'"][data-rowtype="subcategory"]').forEach((row=>{let subrandomid=row.dataset.subrandomid;if(subrandomid){var subcategorycategorytotalItemCount=1+weightedevaluationtablebody.querySelectorAll('tr[data-rowtype="subcategorygradeitem"][data-subrandomid="'+subrandomid+'"]').length;row.querySelectorAll("td").forEach((datacell=>{datacell.rowSpan=subcategorycategorytotalItemCount}))}}))},addSubcategory=async randomid=>{let subrandomid=generateUniqueId(),subcategoryaddbtnrow=weightedevaluationtablebody.querySelector('tr[data-randomid="'+randomid+'"][data-rowtype="subcategory"] .add-subcategory-btn').closest("tr");await(0,_str.get_string)("additinerary2","gradereport_gradeconfigwizard").then((function(str){subcategoryaddbtnrow.insertAdjacentHTML("beforebegin",((randomid,subrandomid)=>"\n<tr id=\"'".concat(subrandomid,'" data-randomid="').concat(randomid,'" data-subrandomid="').concat(subrandomid,'" data-rowtype="subcategory">\n  <td class="subcategory" rowspan="2">\n    <input type="text" name="categories[').concat(randomid,"][subcategories][").concat(subrandomid,'][name]" value="">').concat(removeitemiconhtml(randomid),'\n  </td>\n  <td class="weight-1">\n    <input type="number" name="categories[').concat(randomid,"][subcategories][").concat(subrandomid,'][weight]" size="4" value="1">\n  </td>\n</tr>\n'))(randomid,subrandomid)+((randomid,subrandomid,str)=>'\n<tr data-randomid="'.concat(randomid,'" data-subrandomid="').concat(subrandomid,'" data-rowtype="subcategorygradeitem">\n  <td class="subcategorygradeitem add-btn">\n    <button type="button"\n      class="add-subcategorygradeitem-btn align-items-center block-add btn btn-secondary d-flex"\n      data-gradeitemaddtarget="subcategorygradeitem"\n      data-toggle="modal"\n      data-target="#available-gradeitems-modal-id">\n      <span class="pluscontainer icon-no-margin icon-size-3 d-flex p-2 mr-3">\n          <i class="icon fa fa-plus fa-fw" aria-hidden="true"></i>\n      </span>\n      <span>').concat(str,'</span>\n    </button>\n  </td>\n  <td class="weight-2">\n  </td>\n</tr>\n'))(randomid,subrandomid,str))})),weightedevaluationtablebody.querySelector('tr[data-randomid="'+randomid+'"][data-subrandomid="'+subrandomid+'"][data-rowtype="subcategory"]').querySelector(".remove-item-icon").addEventListener("click",removeSubcategoryCallback),recalculateRowspans(randomid)},removeSubcategory=(randomid,subrandomid)=>{weightedevaluationtablebody.querySelectorAll('tr[data-subrandomid="'+subrandomid+'"][data-gradeitemid][data-rowtype="subcategorygradeitem"]').forEach((row=>{removeSubcategoryGradeitem(randomid,subrandomid,row.dataset.gradeitemid)})),weightedevaluationtablebody.querySelectorAll('tr[data-subrandomid="'+subrandomid+'"][data-rowtype="subcategorygradeitem"]').forEach((row=>{row.remove()})),weightedevaluationtablebody.querySelector('tr[data-subrandomid="'+subrandomid+'"][data-rowtype="subcategory"]').remove(),recalculateRowspans(randomid)},addSubcategoryGradeitem=(randomid,subrandomid,gradeitem)=>{let gradeitemid=gradeitem.dataset.id,gradeitemname=gradeitem.dataset.displayname;weightedevaluationtablebody.querySelector('tr[data-randomid="'+randomid+'"][data-subrandomid="'+subrandomid+'"][data-rowtype="subcategorygradeitem"] .subcategorygradeitem .add-subcategorygradeitem-btn').closest("tr").insertAdjacentHTML("beforebegin",((randomid,subrandomid,gradeitemid,gradeitemname)=>'\n<tr data-randomid="'.concat(randomid,'" data-subrandomid="').concat(subrandomid,'"\ndata-gradeitemid="').concat(gradeitemid,'" data-rowtype="subcategorygradeitem">\n  <td class="subcategorygradeitem">\n  ').concat(gradeitemname).concat(removeitemiconhtml(randomid),'\n  <input name="categories[').concat(randomid,"][subcategories][").concat(subrandomid,"][items][").concat(gradeitemid,'][id]"\n  value="').concat(gradeitemid,'" type="hidden">\n  </td>\n  <td class="weight-2">\n    <input type="number" name="categories[').concat(randomid,"][subcategories][").concat(subrandomid,"][items][").concat(gradeitemid,'][weight]"\n    size="4" value="1">\n  </td>\n</tr>\n'))(randomid,subrandomid,gradeitemid,gradeitemname)),weightedevaluationtablebody.querySelector('tr[data-randomid="'+randomid+'"][data-subrandomid="'+subrandomid+'"][data-rowtype="subcategorygradeitem"][data-gradeitemid="'+gradeitemid+'"]').querySelector(".remove-item-icon").addEventListener("click",removeSubcategoryGradeItemCallback),recalculateRowspans(randomid)},removeSubcategoryGradeitem=(randomid,subrandomid,gradeitemid)=>{weightedevaluationtablebody.querySelector('tr[data-randomid="'+randomid+'"][data-subrandomid="'+subrandomid+'"][data-gradeitemid="'+gradeitemid+'"][data-rowtype="subcategorygradeitem"]').remove(),(gradeitemid=>{let gradeitem=gradeitemsmodal.querySelector('[data-id="'+gradeitemid+'"]');gradeitem.closest("div").classList.remove("d-none"),gradeitem.checked=!1})(gradeitemid),recalculateRowspans(randomid)},addCategoryButtonClickCallback=()=>{let categorynameinput=document.getElementById("weightedevaluations-category-create-name");categorynameinput.value=categorynameinput.value.trim();let categoryname=categorynameinput.value;""!==categoryname&&((async categoryname=>{saveandexitbutton.classList.contains("disabled-box")&&saveandexitbutton.classList.remove("disabled-box");let randomid=generateUniqueId(),categorynamecontent=categoryname+removeitemiconhtml(randomid),newcategoryrowhtml=((randomid,categoryname,categorynamecontent)=>'\n<tr id="'.concat(randomid,'" data-randomid="').concat(randomid,'" data-rowtype="category">\n  <td class="category" rowspan="3">\n    <input name="categories[').concat(randomid,'][name]" type="hidden" value="').concat(categoryname,'"/>\n    ').concat(categorynamecontent,"\n  </td>\n</tr>\n"))(randomid,categoryname,categorynamecontent),newrowshtml=newcategoryrowhtml;await(0,_str.get_string)("additinerary1","gradereport_gradeconfigwizard").then((function(str){newrowshtml+=((randomid,str)=>'\n<tr data-randomid="'.concat(randomid,'" data-rowtype="subcategory">\n  <td class="subcategory add-btn" rowspan="2">\n    <button type="button" class="add-subcategory-btn align-items-center block-add btn btn-secondary d-flex">\n      <span class="pluscontainer icon-no-margin icon-size-3 d-flex p-2 mr-3">\n          <i class="icon fa fa-plus fa-fw" aria-hidden="true"></i>\n      </span>\n      <span>').concat(str,"</span>\n    </button>\n  </td>\n</tr>\n"))(randomid,str)})),newrowshtml+=((randomid,subrandomid)=>'\n<tr data-randomid="'.concat(randomid,'" data-subrandomid="').concat(subrandomid,'" data-rowtype="subcategorygradeitem">\n  <td class="subcategorygradeitem">\n  </td>\n  <td class="weight-2">\n  </td>\n</tr>\n'))(randomid,"");let weightedevaluationtablebodylastrow=weightedevaluationtablebody.querySelector("tr:last-child");weightedevaluationtablebodylastrow?weightedevaluationtablebodylastrow.insertAdjacentHTML("afterend",newrowshtml):weightedevaluationtablebody.innerHTML+=newrowshtml;let newcategoryrow=weightedevaluationtablebody.querySelector('[data-randomid="'+randomid+'"][data-rowtype="category"]'),newsubcategorybuttonrow=weightedevaluationtablebody.querySelector('[data-randomid="'+randomid+'"][data-rowtype="subcategory"]');newcategoryrow.querySelector(".remove-item-icon").addEventListener("click",removeCategoryCallback),newsubcategorybuttonrow.querySelector('tr[data-randomid="'+randomid+'"] .subcategory .add-subcategory-btn').addEventListener("click",addSubcategoryButtonCallback)})(categoryname),categorynameinput.value="")},availableGradeItemsModalShowCallback=event=>{let button=event.relatedTarget,callerrandomid=button.closest("tr").dataset.randomid,gradeitemaddtarget=button.dataset.gradeitemaddtarget,gradeitemid=button.closest("td").dataset.gradeitemid,callersubrandomid=button.closest("tr").dataset.subrandomid;gradeitemsmodal.dataset.gradeitemaddtarget=gradeitemaddtarget,gradeitemsmodal.dataset.callerrandomid=callerrandomid,gradeitemsmodal.dataset.callersubrandomid=callersubrandomid,gradeitemsmodal.dataset.gradeitemid=gradeitemid},availableGradeItemsModalConfirmCallback=()=>{let gradeitemaddtarget=gradeitemsmodal.dataset.gradeitemaddtarget,randomid=gradeitemsmodal.dataset.callerrandomid,subrandomid=gradeitemsmodal.dataset.callersubrandomid,gradeitems=gradeitemsmodal.querySelectorAll('input[type="checkbox"]:checked:not(.d-none)');if("subcategorygradeitem"===gradeitemaddtarget)((randomid,subrandomid,gradeitems)=>{gradeitems.forEach((gradeitem=>{addSubcategoryGradeitem(randomid,subrandomid,gradeitem)}))})(randomid,subrandomid,gradeitems),(gradeitems=>{gradeitems.forEach((gradeitem=>{gradeitem.closest("div").classList.add("d-none"),gradeitem.checked=!1}))})(gradeitems),(0,_jquery.default)(gradeitemsmodal).modal("hide")},removeCategoryCallback=event=>{(randomid=>{weightedevaluationtablebody.querySelectorAll('tr[data-rowtype="subcategory"][data-randomid="'+randomid+'"][data-subrandomid]').forEach((subcategoryrow=>{let subrandomid=subcategoryrow.dataset.subrandomid;removeSubcategory(randomid,subrandomid)})),weightedevaluationtablebody.querySelectorAll('tr[data-randomid="'+randomid+'"]').forEach((row=>row.remove())),weightedevaluationtablebody.querySelectorAll('tr[data-rowtype="category"]').length<1&&saveandexitbutton.classList.add("disabled-box")})(event.target.dataset.randomid)},addSubcategoryButtonCallback=event=>{let randomid=event.target.closest("tr").dataset.randomid;addSubcategory(randomid)},removeSubcategoryCallback=event=>{let targetrow=event.target.closest("tr"),randomid=targetrow.dataset.randomid,subrandomid=targetrow.dataset.subrandomid;removeSubcategory(randomid,subrandomid)},removeSubcategoryGradeItemCallback=event=>{let targetrow=event.target.closest("tr"),randomid=targetrow.dataset.randomid,subrandomid=targetrow.dataset.subrandomid,gradeitemid=targetrow.dataset.gradeitemid;removeSubcategoryGradeitem(randomid,subrandomid,gradeitemid)};_exports.init=()=>{addcategorybtn.addEventListener("click",addCategoryButtonClickCallback),(0,_jquery.default)(gradeitemsmodal).on("show.bs.modal",availableGradeItemsModalShowCallback),gradeitemsmodalacceptbutton.addEventListener("click",availableGradeItemsModalConfirmCallback)}}));

//# sourceMappingURL=weightedevaluations.min.js.map
